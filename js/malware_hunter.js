function iniciarMalwareHunter(modoProfessor = false) {
    const gameContainer = document.getElementById("game-container");
    gameContainer.style.display = "block";

    const questions = [
        {
            question: "Seu computador est√° funcionando anormalmente lento e voc√™ percebe programas estranhos em execu√ß√£o. O que isso pode indicar?",
            answers: [
                "Seu computador est√° ficando velho e precisa ser substitu√≠do",
                "Voc√™ deve baixar um otimizador de PC de um an√∫ncio",
                "Seu computador pode estar infectado com malware",
                "Voc√™ precisa de mais extens√µes de navegador para melhorar o desempenho"
            ],
            correct: 2
        },
        {
            question: "O que um malware do tipo 'keylogger' √© projetado para fazer?",
            answers: [
                "Criptografar seus arquivos e exigir resgate",
                "Registrar tudo o que voc√™ digita, incluindo senhas",
                "Criar uma porta dos fundos para acesso remoto",
                "Diminuir o tempo de resposta do teclado"
            ],
            correct: 1
        },
        {
            question: "Seu antiv√≠rus detecta um programa potencialmente indesejado (PUP). O que √© isso?",
            answers: [
                "Um falso positivo que deve ser ignorado",
                "Um arquivo de sistema cr√≠tico que foi corrompido",
                "Software que pode ser indesejado mas n√£o √© necessariamente prejudicial",
                "Um trojan backdoor que precisa de remo√ß√£o imediata"
            ],
            correct: 2
        },
        {
            question: "Qual a√ß√£o mais reduz suas chances de pegar malware?",
            answers: [
                "Clicar em todos os links de emails desconhecidos",
                "Atualizar regularmente seu sistema operacional e aplicativos",
                "Desativar seu firewall",
                "Baixar software crackeado"
            ],
            correct: 1
        },
        {
            question: "O que voc√™ deve fazer se acidentalmente baixar um arquivo suspeito?",
            answers: [
                "Abri-lo rapidamente para ver o que acontece",
                "Excluir o arquivo e executar uma verifica√ß√£o completa com antiv√≠rus",
                "Ignor√°-lo, pois n√£o faz diferen√ßa",
                "Enviar para todos os amigos"
            ],
            correct: 1
        },
        {
            question: "Qual dos seguintes √© um exemplo de malware?",
            answers: [
                "Programa de planilha (Excel, LibreOffice Calc)",
                "Cavalo de Troia disfar√ßado como um aplicativo leg√≠timo",
                "Navegador web (Chrome, Edge, Firefox)",
                "Editor de texto (Notepad, Vim, Sublime)"
            ],
            correct: 1
        },
        {
            question: "O que √© 'ransomware'?",
            answers: [
                "Uma atualiza√ß√£o de seguran√ßa para seu sistema",
                "Software que criptografa seus arquivos e pede pagamento",
                "Uma ferramenta de backup",
                "Um tipo de componente de hardware"
            ],
            correct: 1
        },
        {
            question: "E-mails de phishing geralmente tentam:",
            answers: [
                "Obter suas informa√ß√µes pessoais ou financeiras",
                "Instalar atualiza√ß√µes oficiais de software",
                "Melhorar a velocidade do seu sistema",
                "Deixar voc√™ jogar jogos online"
            ],
            correct: 0
        },
        {
            question: "Qual √© uma maneira comum de propaga√ß√£o de malware?",
            answers: [
                "Atrav√©s de anexos de e-mail",
                "Apenas atrav√©s de falhas de hardware",
                "Digita√ß√£o manual de c√≥digo pelos usu√°rios",
                "Usando apenas impressoras"
            ],
            correct: 0
        },
        {
            question: "Qual pr√°tica ajuda a evitar infec√ß√µes por malware?",
            answers: [
                "Abrir anexos de remetentes desconhecidos",
                "Manter o antiv√≠rus e o sistema operacional atualizados",
                "Desativar atualiza√ß√µes autom√°ticas",
                "Desligar o firewall"
            ],
            correct: 1
        }
    ];

    let current = 0;
    let score = 0;
    let streak = 0;
    let jogoId = 3;

    function renderQuestion() {
        const q = questions[current];
        gameContainer.innerHTML = `
            <div class="game-section">
                <h2>Malware Hunter</h2>
                <span class="badge-level">Intermedi√°rio</span>
                <p><strong>Quest√£o ${current + 1} de ${questions.length}</strong></p>
                <p>${q.question}</p>
                <div id="respostas"></div>
                <p id="feedback"></p>
                <button id="next-btn" style="display:none;" class="next-btn">Pr√≥xima</button>
            </div>
        `;

        const respostas = document.getElementById("respostas");
        q.answers.forEach((resp, index) => {
            const btn = document.createElement("button");
            btn.textContent = resp;
            btn.className = "jogo-btn";
            btn.addEventListener("click", () => verificarResposta(index));
            respostas.appendChild(btn);
        });

        document.getElementById("next-btn").addEventListener("click", () => {
            current++;
            if (current < questions.length) {
                renderQuestion();
            } else {
                mostrarResultado();
            }
        });
    }

    function verificarResposta(i) {
        const q = questions[current];
        const botoes = document.querySelectorAll("#respostas .jogo-btn");
        botoes.forEach(btn => btn.disabled = true);
        let feedback = document.getElementById("feedback");
        let pontosGanhos = 0;
        let multiplicador = 1;

        if (i === q.correct) {
            streak++;
            multiplicador = streak >= 3 ? 2 : 1;
            pontosGanhos = 100 * multiplicador;
            score += pontosGanhos;
            botoes[i].classList.add("resposta-certa");
            feedback.textContent = `‚úîÔ∏è Correto! +${pontosGanhos} pontos (x${multiplicador})`;
            feedback.style.color = "#2ecc71";
        } else {
            botoes[i].classList.add("resposta-errada");
            streak = 0;
            feedback.textContent = "‚ùå Resposta errada.";
            feedback.style.color = "#e74c3c";
        }

        const nextBtn = document.getElementById("next-btn");
        nextBtn.style.display = "inline-block";

        if (!modoProfessor) {
            const token = localStorage.getItem("token");
            fetch(`${API_BASE_URL}/games/score/`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`
                },
                body: JSON.stringify({
                    pontuacao: pontosGanhos,
                    multiplicador: multiplicador,
                    jogo_id: jogoId
                })
            }).catch(err => console.error("Erro ao guardar pontua√ß√£o:", err));
        }
    }

    function mostrarResultado() {
        gameContainer.innerHTML = `
            <div class="game-section">
                <h2>Fim do Jogo!</h2>
                <p>Pontua√ß√£o final: ${score}</p>
                <p>Streak final: ${streak}</p>
                ${score >= 900 ? "<p>Incr√≠vel! √âs um verdadeiro ca√ßador de malware üß†üî•</p>" :
                    score >= 700 ? "<p>Muito bem! Est√°s atento aos perigos digitais üîç</p>" :
                    "<p>Continua a praticar! ‚ö†Ô∏è</p>"}
            </div>
        `;
        if (!modoProfessor && typeof loadStats === "function") {
            loadStats();
        }
    }

    renderQuestion();
}
